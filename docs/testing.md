# Project Validation & Verification

## 1. Процес тестування

Процес тестування - відповідальний етап, адже саме під час нього потрібно переконатися, чи відповідає розроблювана система поставленим функціональним і нефункціональним вимогам. Тому головна задача тестування показати надійність, захищеність та готовність системи до використання в реальних умовах.

Система повинна бути протестована зі сторони усіх її компонент, а також під час їхньої взаємодії. Процес тестування не можна відокремити від процесу розробки, адже з найпершими строками коду з’являються й перші тести, що перевіряють логіку мінімальних незалежних частин, - юніт-тести. Вони створюються безпосередньо кожним із розробників під час написання коду і дозволяють спіймати найбільш типові помилки якомога раніше й надають змогу дізнатися, чи не виникло нових помилок або непередбачуваної поведінки під час втілення нового функціоналу.

### 1.1 Процес тестування серверної частини

У ході тестування серверної частини системи було обрано підхід, що перевіряє систему на відповідність специфікації згори донизу. Тобто спочатку тестами покривається зовнішній інтерфейс серверу, що буде доступний клієнтам і перевіряється на відповідність специфікації. Для відтворення процесу роботи системи використовуються так звані “стаби” - методи-заглушки, що не виконують змістовних дій у системі, а лише повертають наперед приготовані дані, щоб відтворити певні сценарії й перевірити роботу системи за умови крайніх значень і вхідних параметрів. 

![](https://d2mxuefqeaa7sj.cloudfront.net/s_F36EE2C97722ED9F76CAA18837C304AA0E717F999A7CF0046786C5E6708C3FA8_1527705587077_Screenshot_20180530_212349.png)


Далі відповідним чином тестами покривається шар, що знаходиться нижче за зовнішній інтерфейс, і використовуються методи-заглушки для рівню інтерфейсів та рівню бази. Таким чином послідовно відбувається модульне тестування серверної частини й можна отримати певний рівень впевненості в її коректній роботі. І лише після модульного тестування можна приступити до інтеграційного тестування, де за умов штучно створених сценаріїв можна перевірити коректність використання спільних даних та комунікації між різними процесами та внутрішніми сервісами.

Також для серверної частини системи потрібно провести навантажувальне тестування, що дозволяє перевірити на відповідність специфікації максимальну кількість користувачів, що можуть використовувати систему в один момент часу, і стабільність роботи системи за умов стресового навантаження.

### 1.2 Процес тестування Web-клієнту

Тестування WEB-клієнту має на меті усунути необхідність ручного тестування системи після кожної зміни. Основним способом тестування є регресійне тестування. До тестування робляться скріншоти усіх компонентів. Під час самого тестування збирається візуальна різниця між зробленими до тестування і у момент тестування скріншотами. Ця різниця показується розробнику, який має вирішити, чи є ці зміни навмисними, чи носять вони випадкових характер.
Якщо випадкових змін немає, то цей набір скріншотів зберігається для наступного тестування.

Другий варіант тестування — юніт-тестування. При цьому для кожного компоненту пишуться тести, що перевіряють поведінку компоненту згідно специфікації. Основна стратегія тестування — перевірити усі можливі комбінації вхідних параметрів та усі помилкові параметри, що призводять до конкретних помилок.

### 1.3 Процес тестування Android додатку

Тестування Android додатку системи складається з 3 видів тестування:

- Unit-тестування. Виконуються автоматичні тести для перевірки основної бізнес логіки додатку. Головна особливість таких тестів — абстрагованість від платформи, що забезпечує швидкість їх виконання. Така особливість дає можливість створювати велику кількість тестів для покриття тестами усієї бізнес логіки.
- UI-тестування. Виконуються автоматичні тести для перевірки функціонування користувацького інтерфейсу. Такі тести повинні виконуватись на пристрої зі встановленою операційною системою Android. Для спрощення виконання таких тестів використовується емулятор — програма, яка імітує Android пристрій. Таке обмеження зумовлює порівняно великий час його виконання, тому кількісьт UI-тестів значно менше ніж Unit-тестів і покривають вони найбільш важливі частини користувацького інтерфейсу.
- Функціональні тести — автоматичні або ручні тести, у яких перевіряються повноцінні варіанти роботи користувача з додатком, включаючи бізнес логіку, користувацький інтерфейс та інтеграцію з веб-сервером.

Усі автоматичні тести виконуються за допомогою Continuous Integration(CI) на базі сервісу [TravisCI](https://travis-ci.org/). До репозиторію проекта додається конфігураційний файл, який описує ланцюг операцій для даного репозиторію. При кожному завантаженні сирців до [системи кортролю версій](http://github.com) у головну гілку спрацьовує механізм, що сповіщає систему CI про початок виконання ланцюга операцій. До цього ланцюга входять такі операції:

- Компіляція проекту
- Виконання автоматичних Unit тестів
- Виконання автоматичних UI тестів
- Завантаження зібраного додатку до Сontinues Delivery(CD) системи.

У якості Continuous Delivery системи використовується сервіс [Fabric Beta](https://fabric.io). Тестувальник, який доданий до CD системи через додаток дистрибуції може завантажити нову версію додатку і провести його ручне тестування. Також для обліку усіх неочікуваних завершень додатку, викликаних помилками у додаток вбудований сервіс [Fabric Crashlytics](https://fabric.io/kits/android/crashlytics). Такий сервіс допомагає встановити причини помилок при ручному тестуванні.

### 1.4 Користувацьке тестування системи в цілому

Користувацьке тестування полягає у перевірці системи на виконання її основних функцій (функціональних вимог) та адекватність інтерфейсу до використання. Якщо перевірка ергономічності виявляє будь-які труднощі (наприклад, складності в розумінні інструкцій, виконанні дій чи інтерпретації відповідей системи), то мають зроблені відповідні доопрацювання продукту і тестування мають бути повторені.
Системне тестування відбувається над проектом у цілому за допомогою методу «чорної скриньки» (або поведінкове тестування - стратегія (метод) тестування функціональної поведінки об'єкта (програми, системи) з точки зору зовнішнього світу, при якому не використовується знання про внутрішній устрій тестованого об'єкта. Під стратегією розуміють систематичні методи відбору та створення тестів для тестового набору. Стратегія поведінкового тесту виходить з технічних вимог і їх специфікацій). Структура програми не має ніякого значення, для перевірки доступні тільки входи й виходи, видимі користувачеві.

Спостереження за тим, як люди взаємодіють з продуктом, нерідко дозволяють знайти для нього більш оптимальні рішення. 

На даному етапі перевіряється виявляються помилки наступного характеру:

- Помилки у функціональності за допомогою інтерфейсу;
- Необроблені виключення при взаємодії з інтерфейсом;
- Втрата або перекручення даних, переданих через елементи інтерфейсу;
- Помилки в інтерфейсі (невідповідність проектної документації, відсутність елементів інтерфейсу).

## 2. Специфікація тестів

### 2.1 Тестування системних вимог

| №  | Найменування
тестування        | Процес                                                                                                                                                                                                                                                                                                                                         | Результат                                                                                                       |
| -- | ------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| 1  | Реєстрація                     | Перехід на сторінку реєстрації, ввід даних (створення логіну і паролю)                                                                                                                                                                                                                                                                         | Створення акаунта користувача                                                                                   |
| 2  | Реєстрація під час замовлення  | Під час замовлення заповнитити поля для реєстрації і переконатися в створенні акаунту.                                                                                                                                                                                                                                                         | Створений акаунт для конкретного користувача                                                                    |
| 3  | Авторизація                    | Здійснити вхід до особистого кабінету за допомогою телефону/e-mail та паролю або за допомогою облікового запису в соціальних мережах (Google, Facebook)                                                                                                                                                                                        | Повідомлення про успішну авторизацію                                                                            |
| 4  | Перегляд особистих даних       | Переглянути інформацію про свій обліковий запис: прізвище та ім’я, контактний телефон, email, адреси доставки та бажаний спосіб оплати. Спробувати змінити особисті дані й додати інші контактний телефон, адресу доставки та спосіб оплати.                                                                                                   | Перевірені можливості перегляду і редагування особистих даних                                                   |
| 5  | Відстеження статусу замовлення | Зареєстровані користувач переглядає список поточних та вже виконаних замовлень в особистому кабінеті. У списку міститься назва товарів, кількість замовлених одиниць кожного номіналу (якщо їх декілька), ціна кожного товару та замовлення в цілому, обраний спосіб доставки та поточний статус замовлення (“доставляється”, “виконано” тощо) | Перевірені можливості перегляду деталей замовлення, виконується синхронізація з сервісом доставки.              |
| 6  | Відстеження доставки товару    | Переглянути статус доставки товару в особистому кабінеті.                                                                                                                                                                                                                                                                                      | Перевірка можливості отримання статусу доставки товару за його номером.                                         |
| 7  | Перегляд каталогу з товарами   | Відкрити каталог. Перейти до певної категорії. Переглянути доступні товари.                                                                                                                                                                                                                                                                    | Легкий перехід між категоріями і перегляд доступних товарів.                                                    |
| 8  | Додавання товарів у кошик      | Зайти у каталог і додати товар до корзини.                                                                                                                                                                                                                                                                                                     | Перевірка виконання додавання товару до корзини.                                                                |
| 9  | Внесення змін до кошика        | Видалення товару з кошика                                                                                                                                                                                                                                                                                                                      | Перевірка видалення товару з кошика та об'єкта з бази даних.                                                    |
| 10 | Оформлення замовлення          | Оформити замовлення: введення у форми контактні дані, спосіб отримання товару та спосіб оплати покупки.                                                                                                                                                                                                                                        | Створене замовлення, яке може бути переглянуте користувачем у кабінеті. Перевірка запису об'єкта до бази даних. |

### 2.2 Тестування API

Ручне тестування інтеграції з сервісом Нова Пошта. Використовується додаток RestletClient.

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527735722220_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527736175054_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527735874340_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527736153961_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527735966489_image.png)

![](https://d2mxuefqeaa7sj.cloudfront.net/s_BE15C5F3903FA139C785045F4D5E080F2110CB4D7846076326B93C6EE702E045_1527736191252_image.png)

### 2.3 Навантажувальне тестування

За домогою [gatling.io](https://gatling.io/) для того, щоб генерувати штучний трафік користувацьких прецедентів, і GCViewer, щоб виміряти використання пам’яті JVM, на якій запущена наша система, можна визначити приблизно визначити пропускну здатність та максимальне навантаження, які здатна витримати розроблювана система.

Тестування буде проводитися на ноутбуці Dell XPS 13, Intel Core i7 з базовою частотою 1.6 GHz і до 3.3 GHz в режимі Turbo Boost за великого навантаження, та 16 Gb ОЗУ. Для перевірки будуть використовуватися параметри JVM за промовчанням: Xss=1 Mb(розмір стеку кожного з потоків), початковий розмір купи ~ 256 Mb та максимальний - 4 Gb. Тестування буде відбуватися з піднятою локально реляційною базою даних Postgres 10.4. Ця конфігурація відтворює доволі штучні умови, оскільки затримки та пропускна здатність мережі не відіграють жодної ролі в даному випадку, оскільки немає передачі даних по мережі, що зазвичай є головним вузьким місцем для швидкодії Web-додатків.

Для тестування ми поступово будемо збільшувати кількість користувачів, що використовують систему в один момент часу, і в цей час виміряємо час відповіді, мінімальний та максимальний час відповіді на запит і певні статистичні метрики на основі цих даних. Окрім цього потрібно виміряти споживання пам’яті під час такого навантаження. У сукупності ці дані повинні дати нам змістовну відповідь стосовно того, наскільки стабільною та спроможною є наша система в моменти пікового навантаження.
Для тестування було обрано доволі простий сценарій, у якому користувач переходить за кореневим посиланням і отримує відповідь 200 OK, а також здійснює POST запит на /users, щоб здійснити реєстрацію і очікує успішної відповіді.

## 3. Результати тестування

### 3.1 Результати тестування системних вимог

Система відповідає всім вимогам, що були наведені у пункті 2.1, а саме очікуваний результат збігається з дійсним для всіх прецедентів базового функціоналу системи.

### 3.2 Результати навантажувального тестування

| Кількість запитів | Min час відповіді (мс) | Max час відповіді (мс) | Середній  час відповіді (мс) | Стандартне відхилення | Запитів на секунду | Кількість помилок |
| ----------------- | ---------------------- | ---------------------- | ---------------------------- | --------------------- | ------------------ | ----------------- |
| 400               | 7                      | 679                    | 193                          | 215                   | 171.69             | 0                 |
| 800               | 7                      | 1443                   | 440                          | 471                   | 212.993            | 0                 |
| 1600              | 4                      | 4167                   | 1016                         | 1032                  | 228.571            | 35                |

За описаного вище сценарію система поводить себе доволі стабільно навіть за високих навантаженнях: при 1600 одночасних користувачів кількість помилок була рівно 35, що менше, ніж 2% від загальної кількості запитів, а при наступних спробах навіть менше.

![](https://d2mxuefqeaa7sj.cloudfront.net/s_F36EE2C97722ED9F76CAA18837C304AA0E717F999A7CF0046786C5E6708C3FA8_1527736593516_gcviewer.jpg)

У кількості використаної пам’яті також немає нічого надприроднього: споживання пам’яті не надто високе, кількість зупинок Garbage Collector-y незначна.

Отже за такого примітивного сценарію система себе добре поводить в умовах високого трафіку, чого вдалося досягти за рахунок конфігурації Web-фреймворку akka-http та його ефективної інтеграції з базою даних через бібліотеку Slick, хоча частіше всього саме база даних залишається вузьким місцем пропускної здатності для Web-додатків.

## 4. Історія виявлених дефектів та їх усунення

### 4.1 Дублікати товарів у корзині

Під час тестування працездатності додавання товару в корзину було виявлено такий дефект, що не здійснювалася перевірка того, чи я вже присутній даний товар у кошик, тому для користувача це виглядало не так, що змінилася кількість товарів у корзині даного виду, а в кінці списку товарів у кошику додався ще один запис ідентичний до попереднього.

Задля усунення цього дефекту було додано перевірку на те, чи вже присутній даний товар у кошику, і у випадку, коли це було дійсно так, внутрішній сервіс, що відповідає за обробку кошика, не створював новий запис того, що товар був доданий, а просто змінював кількість товарів даного виду в кошику.
